package ex09_up_down;

import java.io.File;
import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.oreilly.servlet.MultipartRequest;
import com.oreilly.servlet.multipart.DefaultFileRenamePolicy;

/**
 * Servlet implementation class Upload
 */
@WebServlet("/upload")
public class Upload extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public Upload() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
	  
	  /*
	   * 파일 첨부 선행 작업
	   * 1. http://servlets.com/ 접속
	   * 2. COS File Upload Library - cos-22.05.zip 다운
	   * 3. zip 압축 해제 후 lib/cos.jar 라이브러리 -> 프로젝트 webapp/WEB-INF/lib/cor.jar 옮기기
	   */
	  
	  /*
	   * cos.jar
	   * 1. 업로드 전용 라이브러리
	   * 2. 파일 첨부 폼 양식은 enctype="multipart/form-data"로 설정하는데 이렇게 되면 HttpServletRequest를 사용할 수 없음
	   * 3. HttpServletRequest 대신 사용할 MultipartRequest 클래스를 지원하는 라이브러리
	   */
	  
	  // 첨부 파일의 경로
	  String path = "C:/storage";
	  
	  // 첨부 파일이 저장될 디렉터리가 없으면 새로 생성 
	  File dir= new File(path);
	  if(!dir.exists()) {
	    dir.mkdirs();
	  }
	  
	  // MultipartRequest 객체 생성 (실제 업로드가 진행되는 코드)
	  MultipartRequest mr = new MultipartRequest(
	      request // 원래 사용하던 request
	      , path // 파일 첨부 경로
	      , 1024*1024*50 // 50MB (첨부 파일의 최대 크기)
	      , "UTF-8" // 인코딩
	      , new DefaultFileRenamePolicy()); // 첨부 파일명이 중복되는 경우 첨부 파일의 이름을 바꾸는 기본 정책 (파밀명 뒤에 번호를 붙인다)
	  
	  
	  
	  

	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
